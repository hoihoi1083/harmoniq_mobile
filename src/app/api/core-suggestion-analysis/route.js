
// Required for static export with Capacitor
export const dynamic = 'force-static';

export async function POST(req) {
	try {
		const { userInfo, locale } = await req.json();

		if (!userInfo) {
			return Response.json(
				{ error: "Missing user information" },
				{ status: 400 }
			);
		}

		const { concern, birthday, gender, time } = userInfo;

		// Determine language based on locale
		const language =
			locale === "china" || locale === "zh-CN"
				? "simplified"
				: "traditional";
		const isSimplified = language === "simplified";

		// Get current date context
		const now = new Date();
		const currentYear = now.getFullYear();
		const currentMonth = now.getMonth() + 1; // JavaScript months are 0-indexed
		const currentMonthName = `${currentMonth}æœˆ`;

		// Get the appropriate prompt template based on concern
		const promptTemplate = getPromptTemplate(concern, isSimplified);

		// Enhanced prompt for comprehensive Core Suggestion analysis based on å…«å­—
		const languageInstruction = isSimplified
			? "**é‡è¦ï¼šè¯·å…¨éƒ¨ä½¿ç”¨ç®€ä½“ä¸­æ–‡è¾“å‡ºï¼Œä¸è¦ä½¿ç”¨ç¹ä½“ä¸­æ–‡ã€‚ä¾‹å¦‚ï¼šè´¢è¿ï¼ˆæ­£ç¡®ï¼‰ã€è²¡é‹ï¼ˆé”™è¯¯ï¼‰ï¼›æ—¶é—´ï¼ˆæ­£ç¡®ï¼‰ã€æ™‚é–“ï¼ˆé”™è¯¯ï¼‰ï¼›è°ƒç†ï¼ˆæ­£ç¡®ï¼‰ã€èª¿ç†ï¼ˆé”™è¯¯ï¼‰**"
			: "**é‡è¦ï¼šè«‹å…¨éƒ¨ä½¿ç”¨ç¹é«”ä¸­æ–‡è¼¸å‡ºï¼Œä¸è¦ä½¿ç”¨ç°¡é«”ä¸­æ–‡ã€‚ä¾‹å¦‚ï¼šè²¡é‹ï¼ˆæ­£ç¢ºï¼‰ã€è´¢è¿ï¼ˆéŒ¯èª¤ï¼‰ï¼›æ™‚é–“ï¼ˆæ­£ç¢ºï¼‰ã€æ—¶é—´ï¼ˆéŒ¯èª¤ï¼‰ï¼›èª¿ç†ï¼ˆæ­£ç¢ºï¼‰ã€è°ƒç†ï¼ˆéŒ¯èª¤ï¼‰**";

		const prompt = `ä½ æ˜¯ä¸“ä¸šçš„å…«å­—å‘½ç†åˆ†æå¸ˆã€‚è¯·æ ¹æ®ç”¨æˆ·çš„å…«å­—ä¿¡æ¯è¿›è¡Œä¸ªäººåŒ–çš„æ ¸å¿ƒå¼€è¿å»ºè®®åˆ†æï¼š

${languageInstruction}

ç”¨æˆ·å…«å­—ä¿¡æ¯ï¼š
- ç”Ÿæ—¥ï¼š${birthday}
- æ€§åˆ«ï¼š${gender}
- æ—¶é—´ï¼š${time}
- å…³æ³¨é¢†åŸŸï¼š${concern}

å½“å‰æ—¶é—´ï¼š${currentYear}å¹´${currentMonth}æœˆï¼ˆç°åœ¨æ˜¯${currentMonthName}ï¼‰

è¯·é’ˆå¯¹ç”¨æˆ·çš„å…·ä½“å…«å­—å’Œ${concern}å…³æ³¨é¢†åŸŸï¼Œæä¾›ä¸ªäººåŒ–çš„æ ¸å¿ƒå¼€è¿å»ºè®®ï¼š

${promptTemplate}

**âš ï¸ é‡è¦æ—¶é—´æ ‡æ³¨è¦æ±‚ï¼ˆç°åœ¨æ˜¯${currentYear}å¹´${currentMonth}æœˆï¼‰ï¼š**

1. **èšç„¦æœªæ¥ï¼Œä¸æè¿‡å»**ï¼š
   - âœ… æ­£ç¡®ï¼šã€Œæ¥ä¸‹æ¥çš„ç§‹å­£ï¼ˆ${currentMonth}-10æœˆï¼‰ã€ã€ã€Œå³å°†åˆ°æ¥çš„å†¬å­£ï¼ˆ11-1æœˆï¼‰ã€
   - âŒ é”™è¯¯ï¼šä¸è¦æåŠå·²ç»è¿‡å»çš„æœˆä»½æˆ–å­£èŠ‚ï¼ˆå¦‚3-5æœˆæ˜¥å­£ã€6-8æœˆå¤å­£ç­‰è¿‡å»æ—¶é—´ï¼‰
   - æ‰€æœ‰å»ºè®®å¿…é¡»é¢å‘æœªæ¥ï¼Œä»å½“å‰æœˆä»½ï¼ˆ${currentMonth}æœˆï¼‰å¼€å§‹å¾€å

2. **æœªæ¥æ—¶é—´å¿…é¡»æ˜ç¡®æ ‡æ³¨**ï¼š
   - âœ… æ­£ç¡®ï¼šã€Œæ˜å¹´æ˜¥å­£ï¼ˆ2026å¹´3-5æœˆï¼‰ã€ã€ã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰ã€ã€ã€Œæ˜å¹´åˆï¼ˆ2026å¹´1æœˆï¼‰ã€
   - âœ… æ­£ç¡®ï¼šã€Œæ¥ä¸‹æ¥çš„å†¬å­£ï¼ˆ11-1æœˆï¼‰ã€ã€ã€Œå³å°†åˆ°æ¥çš„ç§‹å­£åæœŸï¼ˆ10æœˆï¼‰ã€
   - âŒ é”™è¯¯ï¼šã€Œæ˜¥å­£ã€ï¼ˆä¸æ˜ç¡®æ˜¯ä»Šå¹´è¿˜æ˜¯æ˜å¹´ï¼‰ã€ã€Œ6æœˆã€ï¼ˆä¸çŸ¥é“æ˜¯å“ªä¸€å¹´ï¼‰
   - æ‰€æœ‰æœªæ¥æœˆä»½å¿…é¡»æ ‡æ³¨å¹´ä»½æˆ–ä½¿ç”¨ã€Œæ˜å¹´ã€ã€Œä»Šå¹´åº•ã€ç­‰æ—¶é—´å‰¯è¯

3. **æ˜ç¡®æ ‡æ³¨æœˆä»½èŒƒå›´**ï¼š
   - âœ… æ­£ç¡®ï¼šã€Œå†¬å­£ï¼ˆ11-1æœˆï¼‰ã€ã€ã€Œæ˜å¹´æ˜¥å­£ï¼ˆ2026å¹´3-5æœˆï¼‰ã€ã€ã€Œç§‹å­£åæœŸï¼ˆ10æœˆï¼‰ã€
   - âœ… æ­£ç¡®ï¼šã€Œ10æœˆåº•å‰ã€ã€ã€Œ11-12æœˆæœŸé—´ã€ã€ã€Œæ˜å¹´1-2æœˆã€
   - âŒ é”™è¯¯ï¼šã€Œæ˜¥å­£ã€ï¼ˆæ²¡æœ‰æœˆä»½èŒƒå›´ï¼‰ã€ã€Œå¤å¤©ã€ï¼ˆæ—¶é—´æ¨¡ç³Šï¼‰
   - å¿…é¡»æä¾›å…·ä½“çš„æœˆä»½èŒƒå›´ï¼Œè®©ç”¨æˆ·æ¸…æ¥šçŸ¥é“ä½•æ—¶è¡ŒåŠ¨

**æ—¶é—´æ ‡æ³¨ç¤ºä¾‹ï¼š**
- ã€Œ10æœˆåº•å‰å®Œæˆå¹´åº¦ç›®æ ‡æ£€è§†ã€
- ã€Œæ¥ä¸‹æ¥çš„å†¬å­£ï¼ˆ11-1æœˆï¼‰é€‚åˆå†…åœ¨è°ƒç†ã€
- ã€Œæ˜å¹´æ˜¥å­£ï¼ˆ2026å¹´3-5æœˆï¼‰æ˜¯äº‹ä¸šå‘å±•çš„å¥½æ—¶æœºã€
- ã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰å‰è¦å®Œæˆé‡è¦å†³ç­–ã€
- ã€Œæ˜å¹´åˆï¼ˆ2026å¹´1-2æœˆï¼‰å¯è€ƒè™‘æ–°çš„æŠ•èµ„æœºä¼šã€

åŸºæœ¬è¦æ±‚ï¼š
1. å¿…é¡»åŸºäºç”¨æˆ·å…·ä½“å…«å­—è¿›è¡Œä¸ªäººåŒ–åˆ†æï¼Œä¸å¯æ³›æ³›è€Œè°ˆ
2. é’ˆå¯¹${concern}é¢†åŸŸæä¾›ä¸“ä¸šä¸”å…·ä½“çš„å»ºè®®
3. æ¯ä¸ªéƒ¨åˆ†å¿…é¡»åŒ…å«å…·ä½“çš„å®æ–½æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹
4. å†…å®¹è¦å…·ä½“å®ç”¨ï¼ŒåŒ…å«å…·ä½“çš„è¡ŒåŠ¨æŒ‡å¯¼
5. è¯­è¨€ä¸“ä¸šä½†æ˜“æ‡‚ï¼Œä½“ç°å…«å­—å‘½ç†çš„ä¸“ä¸šæ€§
6. é¿å…ç©ºæ³›çš„æ¦‚å¿µæ€§æè¿°ï¼Œæä¾›å¯æ‰§è¡Œçš„å»ºè®®
7. ${languageInstruction}
8. **æ‰€æœ‰æ—¶é—´å»ºè®®å¿…é¡»éµå®ˆä¸Šè¿°æ—¶é—´æ ‡æ³¨è¦æ±‚ï¼Œä»${currentMonth}æœˆå¼€å§‹å¾€å**

è¯·ç¡®ä¿åˆ†æè¯¦ç»†æ·±å…¥ï¼Œä¸ºç”¨æˆ·æä¾›çœŸæ­£æœ‰ä»·å€¼ä¸”æ—¶é—´æ˜ç¡®çš„ä¸ªäººåŒ–æŒ‡å¯¼ã€‚

${languageInstruction}`;

		const response = await fetch(
			"https://api.deepseek.com/chat/completions",
			{
				method: "POST",
				headers: {
					"Content-Type": "application/json",
					Authorization: `Bearer ${process.env.DEEPSEEK_API_KEY}`,
				},
				body: JSON.stringify({
					model: "deepseek-chat",
					messages: [
						{
							role: "user",
							content: prompt,
						},
					],
					stream: false,
					max_tokens: 5000,
					temperature: 0.7,
				}),
			}
		);

		if (!response.ok) {
			console.error(
				"DeepSeek API Error:",
				response.status,
				response.statusText
			);

			// Handle 402 Payment Required specifically
			if (response.status === 402) {
				console.log(
					"ğŸ’° DeepSeek API credits exhausted, using fallback response"
				);
				// Return structured fallback content instead of error
				const fallbackContent = generateFallbackContent(
					concern,
					birthday,
					gender,
					isSimplified
				);
				const parsedContent = parseCoreSuggestionContent(
					fallbackContent,
					concern,
					isSimplified
				);

				return Response.json({
					success: true,
					analysis: {
						raw: fallbackContent,
						parsed: parsedContent,
						timestamp: new Date().toISOString(),
						source: "fallback",
					},
				});
			}

			// For other errors, return error response
			return Response.json(
				{ error: "AI analysis service unavailable" },
				{ status: 500 }
			);
		}

		const data = await response.json();
		const aiContent = data.choices?.[0]?.message?.content;

		if (!aiContent) {
			return Response.json(
				{ error: "No analysis generated" },
				{ status: 500 }
			);
		}

		// Clean the AI content to remove disclaimers and unwanted content
		const cleanedContent = cleanAIContent(aiContent);

		// Parse the AI response to extract structured data
		const parsedContent = parseCoreSuggestionContent(
			cleanedContent,
			concern,
			isSimplified
		);

		return Response.json({
			success: true,
			analysis: {
				concern: concern,
				content: cleanedContent,
				parsed: parsedContent,
				timestamp: new Date().toISOString(),
			},
		});
	} catch (error) {
		console.error("Core Suggestion Analysis Error:", error);
		return Response.json(
			{ error: "Analysis generation failed" },
			{ status: 500 }
		);
	}
}

function cleanAIContent(content) {
	if (!content) return content;

	// Remove DeepSeek disclaimers and unwanted content
	let cleaned = content
		// Remove the specific disclaimer you mentioned
		.replace(
			/--- ä»¥ä¸Šå…§å®¹ç”± DeepSeek ç”Ÿæˆï¼Œåƒ…ä¾›åƒè€ƒã€‚ç„å­¸å‘½ç†ä¸¦éç²¾æº–ç§‘å­¸ï¼Œè«‹çµåˆè‡ªèº«ç†æ€§åˆ¤æ–·ï¼Œåˆ‡å‹¿éåº¦æ²‰è¿·ã€‚âœ¨[\s]*---?/g,
			""
		)
		// Remove other variations of DeepSeek disclaimers
		.replace(/---[\s]*ä»¥ä¸Šå…§å®¹ç”±.*?DeepSeek.*?ç”Ÿæˆ.*?---?/g, "")
		.replace(/ä»¥ä¸Šå…§å®¹ç”±.*?DeepSeek.*?ç”Ÿæˆ.*?ã€‚/g, "")
		.replace(/æœ¬åˆ†æç”±.*?AI.*?ç”Ÿæˆ.*?ã€‚/g, "")
		.replace(/\*æ³¨æ„ï¼š.*?åƒ…ä¾›åƒè€ƒ.*?\*/g, "")
		.replace(/å…è²¬è²æ˜ï¼š.*?ã€‚/g, "")
		// Remove repetitive disclaimer patterns
		.replace(/---[\s]*ä»¥ä¸Šå…§å®¹.*?åƒè€ƒ.*?---?/g, "")
		.replace(/\*\*å…è²¬è²æ˜.*?\*\*/g, "")
		// Remove excessive line breaks and clean up
		.replace(/\n{3,}/g, "\n\n")
		.replace(/^\s+|\s+$/g, "")
		// Remove standalone sparkle emojis and similar decorative elements
		.replace(/^\s*âœ¨\s*$/gm, "")
		.replace(/^\s*---\s*$/gm, "")
		.trim();

	return cleaned;
}

function getPromptTemplate(concern, isSimplified = false) {
	const templates = {
		å¥åº·: `
è¯·æŒ‰ç…§ä»¥ä¸‹ä¸¥æ ¼æ ¼å¼æä¾›ä¸ªäººåŒ–å¥åº·å»ºè®®ï¼š

ã€äº”è¡Œè°ƒå’Œã€‘
- **ç¯å¢ƒ**ï¼š[è‰²å½©ç¦å¿Œ]ï¼‹[æ¸©æ¹¿åº¦è¦æ±‚]ï¼ˆä¾‹ï¼šå¤šç”¨é»‘/ç™½/è“è‰²ï¼Œä¿æŒ24Â°Cæ’æ¸©ï¼‰
- **é¥®é£Ÿ**ï¼šâœ… [å®œé£Ÿæ¸…å•]ï¼ˆä¾‹ï¼šé“¶è€³/å†¬ç“œ/ç»¿è±†ï¼‰ âœ˜ [å¿Œé£Ÿæ¸…å•]ï¼ˆä¾‹ï¼šè¾›è¾£/ç¾Šè‚‰/é…’ï¼‰  
- **æ´»åŠ¨**ï¼š[æœ€ä½³è¿åŠ¨]ï¼ˆä¾‹ï¼šæ™¨é—´æ•£æ­¥30åˆ†é’Ÿï¼‰ï¼‹[ç²¾ç¥ç–—æ³•]ï¼ˆä¾‹ï¼šæµæ°´å£°å†¥æƒ³ï¼‰

ã€è¡Œä¸ºå¿ƒæ€§ã€‘
- **ä½œæ¯**ï¼š[ç¡çœ æ—¶é—´]ï¼‹[åˆä¼‘å»ºè®®]ï¼ˆä¾‹ï¼š22:30å‰å…¥ç¡ï¼‹åˆæ†©15åˆ†é’Ÿï¼‰
- **æƒ…ç»ª**ï¼š[æƒ…ç»ªç®¡ç†æ–¹æ³•]ï¼ˆä¾‹ï¼šæ¯æ—¥æ­£å¿µå‘¼å¸3æ¬¡ï¼Œé¿å…é•¿æœŸå¿§è™‘ç„¦è™‘ï¼‰
- **å·¥ä½œ**ï¼š[å·¥ä½œé‡æ§åˆ¶]ï¼ˆä¾‹ï¼šå•æ—¥å·¥ä½œâ‰¤8å°æ—¶ï¼Œé¿å…è¿‡åº¦æ¶ˆè€—ä½“åŠ›ï¼‰

ã€é£æ°´è¾…åŠ©ã€‘
- **åŒ–ç…**ï¼š[ç—…ç¬¦ä½å¤„ç†]ï¼ˆä¾‹ï¼šä¸œå—æ–¹å¿Œå †æ‚ç‰©ï¼Œä¿æŒæ•´æ´ï¼Œå¯æ”¾ç½®é“œåˆ¶åŒ–ç…ç‰©å“ï¼‰
- **èƒ½é‡**ï¼š[æ–¹ä½å¸ƒç½®]ï¼ˆä¾‹ï¼šåŒ—æ–¹æ”¾é›¾åŒ–åŠ æ¹¿å™¨ï¼Œå¢åŠ æ°´æ°”è°ƒèŠ‚èº«ä½“æ°´ç«å¹³è¡¡ï¼‰

ã€æ‹©æ—¶è°ƒå…»ã€‘
- **é»„é‡‘æœŸ**ï¼š[æœ€ä½³è°ƒå…»æ—¶æœºï¼Œå¿…é¡»æ ‡æ³¨å…·ä½“æœˆä»½å’Œå¹´ä»½]ï¼ˆä¾‹ï¼šã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰é€‚åˆç³»ç»Ÿä½“æ£€ã€ã€ã€Œæ˜å¹´æ˜¥å­£ï¼ˆ2026å¹´3-5æœˆï¼‰è¿›è¡Œé‡è¦æ²»ç–—ã€ã€ã€Œæ¥ä¸‹æ¥çš„ç§‹æœ«ï¼ˆ10æœˆåº•ï¼‰æ˜¯å…»è‚ºæœ€ä½³æ—¶æœºã€ï¼‰
- **ç¦å¿ŒæœŸ**ï¼š[éœ€è¦ç‰¹åˆ«å°å¿ƒçš„æ—¶æœŸï¼Œå¿…é¡»æ ‡æ³¨å…·ä½“æœˆä»½å’Œå¹´ä»½]ï¼ˆä¾‹ï¼šã€Œæ˜å¹´å¤å­£ï¼ˆ2026å¹´6-8æœˆï¼‰éœ€æ³¨æ„å¥åº·é£é™©ï¼Œé¿å…æ‰‹æœ¯å’Œå‰§çƒˆè¿åŠ¨ã€ã€ã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰æ…é˜²æ„Ÿå†’æµæ„Ÿã€ã€ã€Œæ¥ä¸‹æ¥çš„å†¬å­£ï¼ˆ11-1æœˆï¼‰æ³¨æ„ä¿æš–é˜²å¯’ã€ï¼‰`,

		è²¡é‹: `
è¯·æŒ‰ç…§ä»¥ä¸‹ä¸¥æ ¼æ ¼å¼æä¾›ä¸ªäººåŒ–è´¢è¿å»ºè®®ï¼š

ã€äº”è¡Œè°ƒå’Œã€‘
- **ä½©æˆ´**ï¼š[å¼€è¿é¥°å“]ï¼ˆä¾‹ï¼šè´´èº«ä½©æˆ´ç®€çº¦é‡‘å±é¥°å“ï¼Œé“¶ã€é“‚é‡‘æœ€ä½³ï¼‰
- **ç¯å¢ƒ**ï¼š[è‰²å½©é…ç½®]ï¼‹[æ–¹ä½å¸ƒç½®]ï¼ˆä¾‹ï¼šå·¥ä½œå±…ä½ç¯å¢ƒå¤šä½¿ç”¨é‡‘ã€æ°´å…ƒç´ è‰²è°ƒï¼‰

ã€è¡Œä¸ºå¿ƒæ€§ã€‘
- **è´¢åŠ¡**ï¼š[ç†è´¢åŸåˆ™]ï¼ˆä¾‹ï¼šå»ºç«‹ä¸¥æ ¼é¢„ç®—ï¼Œè¿½è¸ªæ¯ä¸€ç¬”æ”¶æ”¯ï¼Œåªåšé˜²å¾¡æ€§å‚¨è“„ç†è´¢ï¼‰
- **èŒåœº**ï¼š[å·¥ä½œç­–ç•¥]ï¼ˆä¾‹ï¼šä½è°ƒã€è°¨æ…ã€å¯é ã€‚èšç„¦æœ¬èŒï¼Œé¿å…å·å…¥æ˜¯éï¼‰
- **äººé™…**ï¼š[äº¤å¾€ç¦ä»¤]ï¼ˆä¾‹ï¼šé¿å…é‡‘é’±å¾€æ¥ï¼Œå€Ÿè´·ã€åˆä¼™ã€æ‹…ä¿ï¼‰
- **å¥åº·**ï¼š[å¥åº·æŠ•èµ„]ï¼ˆä¾‹ï¼šå……è¶³ç¡çœ ã€å¥åº·é¥®é£Ÿã€è§„å¾‹è¿åŠ¨ã€å®šæœŸä½“æ£€ï¼‰

ã€é£æ°´è¾…åŠ©ã€‘
- **è´¢ä½**ï¼š[è´¢ä½å¸ƒå±€]ï¼ˆä¾‹ï¼šè¥¿åŒ—æ–¹ã€åŒ—æ–¹é‡ç‚¹å¸ƒå±€ï¼Œæ”¾ç½®é‡‘å±åˆ¶åœ†å½¢ç‰©å“ï¼‰
- **æ˜¯é**ï¼š[åŒ–è§£æ–¹æ³•]ï¼ˆä¾‹ï¼šä¸œå—æ–¹å¿Œæ”¾æ¤ç‰©ã€æµæ°´ã€åŠ¨æ€ç‰©å“ï¼Œå¯æ”¾ç½®é‡‘å±åˆ¶åœ†å½¢ç‰©å“åŒ–è§£ï¼‰
- **ç¦å¿Œ**ï¼š[é£æ°´ç¦ä»¤]ï¼ˆä¾‹ï¼šä»»ä½•å¸ƒå±€ä»¥å®‰å…¨ã€å®ç”¨ã€ä¸å½±å“æ­£å¸¸ç”Ÿæ´»å·¥ä½œä¸ºå‰æï¼‰

ã€æ‹©æ—¶è€ŒåŠ¨ã€‘
- **æœ€ä½³**ï¼š[æ“ä½œæ—¶æœºï¼Œå¿…é¡»æ ‡æ³¨å…·ä½“æœˆä»½å’Œå¹´ä»½]ï¼ˆä¾‹ï¼šã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰å‰å®Œæˆé‡è¦è´¢åŠ¡æ“ä½œã€ã€ã€Œæ˜å¹´æ˜¥å­£ï¼ˆ2026å¹´3-5æœˆï¼‰æ˜¯æŠ•èµ„å¥½æ—¶æœºã€ã€ã€Œæ¥ä¸‹æ¥çš„ç§‹å­£ï¼ˆ10æœˆï¼‰é€‚åˆç†è´¢è°ƒæ•´ã€ï¼‰
- **ç¦å¿Œ**ï¼š[éœ€è¦é¿å…çš„æ—¶æœŸå’Œè¡Œä¸ºï¼Œå¿…é¡»æ ‡æ³¨å…·ä½“æœˆä»½å’Œå¹´ä»½]ï¼ˆä¾‹ï¼šã€Œæ˜å¹´å¤å­£ï¼ˆ2026å¹´6-8æœˆï¼‰é¿å…å¤§é¢æŠ•èµ„å’Œå€Ÿè´·ã€ã€ã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰å‰ä¸å®œå†’é™©æŠ•æœºã€ã€ã€Œæ¥ä¸‹æ¥çš„å†¬å­£ï¼ˆ11-1æœˆï¼‰æ…é˜²è´¢åŠ¡é£é™©ã€ï¼‰`,

		å·¥ä½œ: `
è¯·æŒ‰ç…§ä»¥ä¸‹ä¸¥æ ¼æ ¼å¼æä¾›ä¸ªäººåŒ–å·¥ä½œå»ºè®®ï¼š

ã€äº”è¡Œè°ƒå’Œã€‘
- **ä½©æˆ´**ï¼š[å·¥ä½œå¼€è¿]ï¼ˆä¾‹ï¼šç®€çº¦é‡‘å±é¥°å“æå‡ä¸“ä¸šå½¢è±¡ï¼ŒåŠå…¬æ¡Œæ”¾ç½®å°å‹é‡‘å±æˆ–æ°´æ™¶æ‘†ä»¶ï¼‰
- **ç¯å¢ƒ**ï¼š[åŠå…¬ç¯å¢ƒ]ï¼ˆä¾‹ï¼šå·¥ä½œç©ºé—´å¤šç”¨å†·è‰²è°ƒï¼Œä¿æŒæ¸…æ´æ•´é½ï¼Œé€‚å½“å¼•å…¥æµæ°´éŸ³ä¹ï¼‰

ã€è¡Œä¸ºå¿ƒæ€§ã€‘
- **å†³ç­–**ï¼š[å†³ç­–æ¨¡å¼]ï¼ˆä¾‹ï¼šé‡å¤§å†³å®šå‰48å°æ—¶å†·é™æœŸï¼Œå¤šæ–¹å¾è¯¢æ„è§åå†è¡ŒåŠ¨ï¼‰
- **äººé™…**ï¼š[èŒåœºäººé™…]ï¼ˆä¾‹ï¼šé¿å…å‚ä¸åŠå…¬å®¤å…«å¦ï¼Œä¸åŒäº‹ä¿æŒé€‚åº¦ä¸“ä¸šè·ç¦»ï¼‰
- **å¥åº·**ï¼š[å·¥ä½œå¥åº·]ï¼ˆä¾‹ï¼šå®šæœŸä½“æ£€ï¼Œä¿æŒè§„å¾‹ä½œæ¯ï¼Œè§†èº«ä½“ä¸ºäº‹ä¸šåŸºçŸ³ï¼‰

ã€é£æ°´è¾…åŠ©ã€‘
- **è´¢ä½**ï¼š[åŠå…¬å¸ƒå±€]ï¼ˆä¾‹ï¼šåº§ä½åæ–¹æœ‰é å±±ï¼Œå·¦é’é¾™ä½æ”¾ç½®é‡è¦ç‰©å“ï¼‰
- **æ˜¯é**ï¼š[åŒ–è§£æ–¹æ³•]ï¼ˆä¾‹ï¼šé¿å…åº§ä½æ­£å¯¹å•æ‰€æˆ–æ¥¼æ¢¯ï¼ŒåŒ–è§£å°–è§’ç…æ°”ï¼‰

ã€æ‹©æ—¶è€ŒåŠ¨ã€‘
- **æœ€ä½³**ï¼š[æœ€ä½³æ—¶æœºï¼Œå¿…é¡»æ ‡æ³¨å…·ä½“æœˆä»½å’Œå¹´ä»½]ï¼ˆä¾‹ï¼šã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰é€‚åˆèŒä¸šå†³ç­–ã€ã€ã€Œæ˜å¹´æ˜¥å­£ï¼ˆ2026å¹´3-5æœˆï¼‰æ˜¯æ±‚èŒå¥½æ—¶æœºã€ã€ã€Œæ¥ä¸‹æ¥çš„ç§‹æœ«ï¼ˆ10æœˆåº•ï¼‰é€‚åˆé¡¹ç›®æ”¶å°¾ã€ï¼‰
- **ç¦å¿Œ**ï¼š[éœ€è¦é¿å…çš„æ—¶æœŸå’Œè¡Œä¸ºï¼Œå¿…é¡»æ ‡æ³¨å…·ä½“æœˆä»½å’Œå¹´ä»½]ï¼ˆä¾‹ï¼šã€Œæ˜å¹´å¤å­£ï¼ˆ2026å¹´6-8æœˆï¼‰é¿å…è·³æ§½å’Œå†²çªã€ã€ã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰å‰ä¸å®œä¸ä¸Šå¸äº‰æ‰§ã€ã€ã€Œæ¥ä¸‹æ¥çš„å†¬å­£ï¼ˆ11-1æœˆï¼‰æ…é˜²èŒåœºå°äººã€ï¼‰`,

		äº‹æ¥­: `
è¯·æŒ‰ç…§ä»¥ä¸‹ä¸¥æ ¼æ ¼å¼æä¾›ä¸ªäººåŒ–äº‹ä¸šå»ºè®®ï¼š

ã€äº”è¡Œè°ƒå’Œã€‘
- **ä½©æˆ´**ï¼š[äº‹ä¸šå¼€è¿]ï¼ˆä¾‹ï¼šä½©æˆ´é€‚åˆçš„å¼€è¿é¥°å“ï¼Œæå‡äº‹ä¸šæ°”åœºï¼‰
- **ç¯å¢ƒ**ï¼š[äº‹ä¸šç¯å¢ƒ]ï¼ˆä¾‹ï¼šåŠå…¬ç¯å¢ƒé…ç½®ï¼Œè‰²å½©å’Œæ–¹ä½å¸ƒç½®ï¼‰

ã€è¡Œä¸ºå¿ƒæ€§ã€‘
- **å†³ç­–**ï¼š[å•†ä¸šå†³ç­–]ï¼ˆä¾‹ï¼šé‡å¤§å•†ä¸šå†³å®šçš„æœ€ä½³æ¨¡å¼å’Œæ³¨æ„äº‹é¡¹ï¼‰
- **äººé™…**ï¼š[å•†ä¸šäººé™…]ï¼ˆä¾‹ï¼šå•†ä¸šåˆä½œä¸­çš„æ³¨æ„äº‹é¡¹å’Œç¦å¿Œï¼‰
- **å¥åº·**ï¼š[äº‹ä¸šå¥åº·]ï¼ˆä¾‹ï¼šæ”¯æ’‘äº‹ä¸šå‘å±•çš„å¥åº·åŸºç¡€ç®¡ç†ï¼‰

ã€é£æ°´è¾…åŠ©ã€‘
- **è´¢ä½**ï¼š[äº‹ä¸šå¸ƒå±€]ï¼ˆä¾‹ï¼šäº‹ä¸šåœºæ‰€çš„é£æ°´å¸ƒå±€å»ºè®®ï¼‰
- **æ˜¯é**ï¼š[ç«äº‰åŒ–è§£]ï¼ˆä¾‹ï¼šåŒ–è§£å•†ä¸šç«äº‰å’Œçº çº·çš„æ–¹æ³•ï¼‰

ã€æ‹©æ—¶è€ŒåŠ¨ã€‘
- **æœ€ä½³**ï¼š[äº‹ä¸šæ—¶æœºï¼Œå¿…é¡»æ ‡æ³¨å…·ä½“æœˆä»½å’Œå¹´ä»½]ï¼ˆä¾‹ï¼šã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰é€‚åˆäº‹ä¸šæ‰©å¼ å†³ç­–ã€ã€ã€Œæ˜å¹´æ˜¥å­£ï¼ˆ2026å¹´3-5æœˆï¼‰æ˜¯å¯åŠ¨æ–°é¡¹ç›®å¥½æ—¶æœºã€ã€ã€Œæ¥ä¸‹æ¥çš„ç§‹æœ«ï¼ˆ10æœˆåº•ï¼‰é€‚åˆå•†ä¸šè°ˆåˆ¤ã€ï¼‰
- **ç¦å¿Œ**ï¼š[éœ€è¦é¿å…çš„æ—¶æœŸå’Œè¡Œä¸ºï¼Œå¿…é¡»æ ‡æ³¨å…·ä½“æœˆä»½å’Œå¹´ä»½]ï¼ˆä¾‹ï¼šã€Œæ˜å¹´å¤å­£ï¼ˆ2026å¹´6-8æœˆï¼‰é¿å…æ¿€è¿›æ‰©å¼ å’Œå¤§é¢æŠ•èµ„ã€ã€ã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰å‰ä¸å®œç­¾ç½²é‡å¤§åˆåŒã€ã€ã€Œæ¥ä¸‹æ¥çš„å†¬å­£ï¼ˆ11-1æœˆï¼‰æ…é˜²åˆä½œé™·é˜±ã€ï¼‰`,

		æ„Ÿæƒ…: `
è¯·æŒ‰ç…§ä»¥ä¸‹ä¸¥æ ¼æ ¼å¼æä¾›ä¸ªäººåŒ–æ„Ÿæƒ…å»ºè®®ï¼š

ã€äº”è¡Œè°ƒå’Œã€‘
- **ä½©æˆ´**ï¼š[æ„Ÿæƒ…å¼€è¿]ï¼ˆä¾‹ï¼šç™½æ°´æ™¶é¡¹é“¾å¢è¿›æ²Ÿé€šç†è§£ï¼Œç²‰æ°´æ™¶æå‡æ„Ÿæƒ…èƒ½é‡ï¼‰
- **æ–¹ä½**ï¼š[æ„Ÿæƒ…æ–¹ä½]ï¼ˆä¾‹ï¼šè¥¿åŒ—æ–¹æ”¾ç½®é“œåˆ¶æµæ°´å™¨ï¼Œå¢è¿›æ„Ÿæƒ…æµåŠ¨ï¼‰

ã€è¡Œä¸ºå¿ƒæ€§ã€‘
- **æ²Ÿé€š**ï¼š[æ²Ÿé€šæŠ€å·§]ï¼ˆä¾‹ï¼š"ä¸‰æ€åè¨€"ä»£æ›¿æŒ‡è´£ï¼Œå¤šç”¨"æˆ‘æ„Ÿå—"å¥å¼è¡¨è¾¾ï¼‰
- **ç¦åŒº**ï¼š[å…³ç³»ç¦å¿Œ]ï¼ˆä¾‹ï¼šä¸ä¸å‰ä»»å•ç‹¬è§é¢ï¼Œé¿å…åœ¨æ„Ÿæƒ…ä¸­æåŠè¿‡å¾€æ‹æƒ…ï¼‰

ã€é£æ°´è¾…åŠ©ã€‘
- **æ¡ƒèŠ±**ï¼š[æ¡ƒèŠ±ä½å¸ƒå±€]ï¼ˆä¾‹ï¼šä¸œå—æ–¹ä¿æŒæ•´æ´æ˜äº®ï¼Œæ”¾ç½®æˆå¯¹çš„ç¾å¥½ç‰©å“ï¼‰
- **åŒ–ç…**ï¼š[æ„Ÿæƒ…åŒ–ç…]ï¼ˆä¾‹ï¼šå§å®¤å¿Œæ”¾é•œå­æ­£å¯¹åºŠé“ºï¼Œç§»é™¤åˆ€å…·ç­‰å°–é”ç‰©å“ï¼‰

ã€æ‹©æ—¶è€ŒåŠ¨ã€‘
- **æœ€ä½³**ï¼š[æ„Ÿæƒ…æ—¶æœºï¼Œå¿…é¡»æ ‡æ³¨å…·ä½“æœˆä»½å’Œå¹´ä»½]ï¼ˆä¾‹ï¼šã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰é€‚åˆæ·±åŒ–å…³ç³»ã€ã€ã€Œæ˜å¹´æ˜¥å­£ï¼ˆ2026å¹´3-5æœˆï¼‰æ˜¯è¡¨ç™½æˆ–æ±‚å©šå¥½æ—¶æœºã€ã€ã€Œæ¥ä¸‹æ¥çš„ç§‹æœ«ï¼ˆ10æœˆåº•ï¼‰é€‚åˆé‡è¦å¯¹è¯ã€ï¼‰
- **ç¦å¿Œ**ï¼š[éœ€è¦é¿å…çš„æ—¶æœŸå’Œè¡Œä¸ºï¼Œå¿…é¡»æ ‡æ³¨å…·ä½“æœˆä»½å’Œå¹´ä»½]ï¼ˆä¾‹ï¼šã€Œæ˜å¹´å¤å­£ï¼ˆ2026å¹´6-8æœˆï¼‰é¿å…äº‰åµå’Œå†·æˆ˜ã€ã€ã€Œä»Šå¹´åº•ï¼ˆ12æœˆï¼‰å‰ä¸å®œåšé‡å¤§å†³å®šã€ã€ã€Œæ¥ä¸‹æ¥çš„å†¬å­£ï¼ˆ11-1æœˆï¼‰æ…é˜²è¯¯ä¼šå’Œç¬¬ä¸‰è€…ã€ï¼‰`,
	};

	return templates[concern] || templates.è²¡é‹;
}

function parseCoreSuggestionContent(content, concern, isSimplified = false) {
	try {
		// Extract main sections with their subsections
		const sections = isSimplified
			? {
					äº”è¡Œè°ƒå’Œ: null,
					è¡Œä¸ºå¿ƒæ€§: null,
					é£æ°´è¾…åŠ©: null,
					æ‹©æ—¶è°ƒå…»: null,
					æ‹©æ—¶è€ŒåŠ¨: null,
				}
			: {
					äº”è¡Œèª¿å’Œ: null,
					è¡Œç‚ºå¿ƒæ€§: null,
					é¢¨æ°´è¼”åŠ©: null,
					æ“‡æ™‚èª¿é¤Š: null,
					æ“‡æ™‚è€Œå‹•: null,
				};

		// Parse each section with better pattern matching
		Object.keys(sections).forEach((sectionName) => {
			const patterns = [
				new RegExp(`ã€${sectionName}ã€‘[\\s\\S]*?(?=ã€|$)`, "g"),
				new RegExp(
					`\\*\\*${sectionName}\\*\\*[\\s\\S]*?(?=\\*\\*|ã€|$)`,
					"g"
				),
				new RegExp(
					`${sectionName}[ï¼š:]?[\\s\\S]*?(?=ã€|\\*\\*|$)`,
					"g"
				),
			];

			for (let pattern of patterns) {
				pattern.lastIndex = 0;
				const match = pattern.exec(content);
				if (match && match[0] && match[0].trim().length > 30) {
					sections[sectionName] = match[0].trim();
					break;
				}
			}
		});

		// Parse subsections for each main section
		const parsedSections = {};
		Object.entries(sections).forEach(([sectionName, sectionContent]) => {
			if (sectionContent) {
				parsedSections[sectionName] = parseSubsections(
					sectionContent,
					sectionName,
					concern,
					isSimplified
				);
			}
		});

		// Generate categories with structured subsections
		const categories = generateStructuredCategories(
			parsedSections,
			concern,
			isSimplified
		);

		const title = isSimplified
			? `å¼€è¿å»ºè®® (${concern}æŒ‡å—)`
			: `é–‹é‹å»ºè­° (${concern}æŒ‡å—)`;

		return {
			sections: sections,
			parsedSections: parsedSections,
			categories: categories,
			title: title,
			coreStrategy: extractCoreStrategy(content, concern, isSimplified),
		};
	} catch (error) {
		console.error("Core suggestion content parsing error:", error);
		return getFallbackCoreSuggestionData(concern, isSimplified);
	}
}

function parseSubsections(
	sectionContent,
	sectionName,
	concern,
	isSimplified = false
) {
	const subsections = {};

	// Define subsection patterns based on section type
	const subsectionPatterns = isSimplified
		? {
				äº”è¡Œè°ƒå’Œ:
					concern === "å¥åº·"
						? ["ç¯å¢ƒ", "é¥®é£Ÿ", "æ´»åŠ¨"]
						: concern === "æ„Ÿæƒ…"
							? ["ä½©æˆ´", "æ–¹ä½"]
							: ["ä½©æˆ´", "ç¯å¢ƒ"],
				è¡Œä¸ºå¿ƒæ€§:
					concern === "å¥åº·"
						? ["ä½œæ¯", "æƒ…ç»ª", "å·¥ä½œ"]
						: concern === "è²¡é‹"
							? ["è´¢åŠ¡", "èŒåœº", "äººé™…", "å¥åº·"]
							: concern === "æ„Ÿæƒ…"
								? ["æ²Ÿé€š", "ç¦åŒº"]
								: ["å†³ç­–", "äººé™…", "å¥åº·"],
				é£æ°´è¾…åŠ©:
					concern === "å¥åº·"
						? ["åŒ–ç…", "èƒ½é‡"]
						: concern === "è²¡é‹"
							? ["è´¢ä½", "æ˜¯é", "ç¦å¿Œ"]
							: concern === "æ„Ÿæƒ…"
								? ["æ¡ƒèŠ±", "åŒ–ç…"]
								: ["è´¢ä½", "æ˜¯é"],
				æ‹©æ—¶è°ƒå…»: ["é»„é‡‘æœŸ", "ç¦å¿ŒæœŸ"],
				æ‹©æ—¶è€ŒåŠ¨: ["æœ€ä½³", "ç¦å¿Œ"],
			}
		: {
				äº”è¡Œèª¿å’Œ:
					concern === "å¥åº·"
						? ["ç’°å¢ƒ", "é£²é£Ÿ", "æ´»å‹•"]
						: concern === "æ„Ÿæƒ…"
							? ["ä½©æˆ´", "æ–¹ä½"]
							: ["ä½©æˆ´", "ç’°å¢ƒ"],
				è¡Œç‚ºå¿ƒæ€§:
					concern === "å¥åº·"
						? ["ä½œæ¯", "æƒ…ç·’", "å·¥ä½œ"]
						: concern === "è²¡é‹"
							? ["è²¡å‹™", "è·å ´", "äººéš›", "å¥åº·"]
							: concern === "æ„Ÿæƒ…"
								? ["æºé€š", "ç¦å€"]
								: ["æ±ºç­–", "äººéš›", "å¥åº·"],
				é¢¨æ°´è¼”åŠ©:
					concern === "å¥åº·"
						? ["åŒ–ç…", "èƒ½é‡"]
						: concern === "è²¡é‹"
							? ["è²¡ä½", "æ˜¯é", "ç¦å¿Œ"]
							: concern === "æ„Ÿæƒ…"
								? ["æ¡ƒèŠ±", "åŒ–ç…"]
								: ["è²¡ä½", "æ˜¯é"],
				æ“‡æ™‚èª¿é¤Š: ["é»ƒé‡‘æœŸ", "ç¦å¿ŒæœŸ"],
				æ“‡æ™‚è€Œå‹•: ["æœ€ä½³", "ç¦å¿Œ"],
			};

	const expectedSubsections =
		subsectionPatterns[sectionName] ||
		(isSimplified ? ["é¡¹ç›®1", "é¡¹ç›®2"] : ["é …ç›®1", "é …ç›®2"]);

	// Extract each subsection
	expectedSubsections.forEach((subsectionName) => {
		const patterns = [
			new RegExp(
				`- \\*\\*${subsectionName}\\*\\*[ï¼š:]?([^\\n]*(?:\\n(?!- \\*\\*)[^\\n]*)*)`
			),
			new RegExp(
				`\\*\\*${subsectionName}\\*\\*[ï¼š:]?([^\\n]*(?:\\n(?!\\*\\*)[^\\n]*)*)`
			),
			new RegExp(
				`${subsectionName}[ï¼š:]([^\\n]*(?:\\n(?!-|\\*\\*)[^\\n]*)*)`
			),
		];

		for (let pattern of patterns) {
			const match = sectionContent.match(pattern);
			if (match && match[1] && match[1].trim().length > 10) {
				subsections[subsectionName] = match[1]
					.trim()
					.replace(/\*\*/g, "")
					.replace(/ã€[^ã€‘]*ã€‘/g, "")
					.replace(/####/g, "")
					.trim();
				break;
			}
		}

		// If no match found, create fallback content
		if (!subsections[subsectionName]) {
			subsections[subsectionName] = isSimplified
				? `${subsectionName}ç›¸å…³å»ºè®®å°†æ ¹æ®æ‚¨çš„å…«å­—è¿›è¡Œä¸ªäººåŒ–åˆ†æ...`
				: `${subsectionName}ç›¸é—œå»ºè­°å°‡æ ¹æ“šæ‚¨çš„å…«å­—é€²è¡Œå€‹äººåŒ–åˆ†æ...`;
		}
	});

	return subsections;
}

function generateStructuredCategories(
	parsedSections,
	concern,
	isSimplified = false
) {
	const categories = [];

	// Generate categories based on available sections
	const elementKey = isSimplified ? "äº”è¡Œè°ƒå’Œ" : "äº”è¡Œèª¿å’Œ";
	const behaviorKey = isSimplified ? "è¡Œä¸ºå¿ƒæ€§" : "è¡Œç‚ºå¿ƒæ€§";
	const fengShuiKey = isSimplified ? "é£æ°´è¾…åŠ©" : "é¢¨æ°´è¼”åŠ©";
	const timingKey1 = isSimplified ? "æ‹©æ—¶è°ƒå…»" : "æ“‡æ™‚èª¿é¤Š";
	const timingKey2 = isSimplified ? "æ‹©æ—¶è€ŒåŠ¨" : "æ“‡æ™‚è€Œå‹•";

	if (parsedSections[elementKey]) {
		categories.push({
			title: isSimplified ? "äº”è¡Œè°ƒå’Œ" : "äº”è¡Œèª¿å’Œ",
			icon: "â­",
			color: "bg-amber-500",
			content: Object.values(parsedSections[elementKey]).join("\n\n"),
			subsections: parsedSections[elementKey],
		});
	}

	if (parsedSections[behaviorKey]) {
		categories.push({
			title: isSimplified ? "è¡Œä¸ºå¿ƒæ€§" : "è¡Œç‚ºå¿ƒæ€§",
			icon: "â¤ï¸",
			color: "bg-red-500",
			content: Object.values(parsedSections[behaviorKey]).join("\n\n"),
			subsections: parsedSections[behaviorKey],
		});
	}

	if (parsedSections[fengShuiKey]) {
		categories.push({
			title: isSimplified ? "é£æ°´è¾…åŠ©" : "é¢¨æ°´è¼”åŠ©",
			icon: "âš™ï¸",
			color: "bg-green-500",
			content: Object.values(parsedSections[fengShuiKey]).join("\n\n"),
			subsections: parsedSections[fengShuiKey],
		});
	}

	const timingSection =
		parsedSections[timingKey1] || parsedSections[timingKey2];
	if (timingSection) {
		const timingTitle = isSimplified
			? concern === "å¥åº·"
				? "æ‹©æ—¶è°ƒå…»"
				: "æ‹©æ—¶è€ŒåŠ¨"
			: concern === "å¥åº·"
				? "æ“‡æ™‚èª¿é¤Š"
				: "æ“‡æ™‚è€Œå‹•";
		categories.push({
			title: timingTitle,
			icon: "ğŸ•’",
			color: "bg-blue-500",
			content: Object.values(timingSection).join("\n\n"),
			subsections: timingSection,
		});
	}

	// Ensure we have at least 4 categories for UI consistency
	while (categories.length < 4) {
		const suggestionText = isSimplified
			? `å»ºè®®${categories.length + 1}`
			: `å»ºè­°${categories.length + 1}`;
		const contentText = isSimplified
			? "æ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆæ›´å¤šä¸ªäººåŒ–å»ºè®®..."
			: "æ­£åœ¨ç‚ºæ‚¨ç”Ÿæˆæ›´å¤šå€‹äººåŒ–å»ºè­°...";
		const subsectionKey = isSimplified ? "åˆ†æä¸­" : "åˆ†æä¸­";
		const subsectionValue = isSimplified
			? "AIæ­£åœ¨æ ¹æ®æ‚¨çš„å…«å­—ç”Ÿæˆæ›´è¯¦ç»†çš„å»ºè®®"
			: "AIæ­£åœ¨æ ¹æ“šæ‚¨çš„å…«å­—ç”Ÿæˆæ›´è©³ç´°çš„å»ºè­°";

		categories.push({
			title: suggestionText,
			icon: "ğŸ“‹",
			color: "bg-gray-500",
			content: contentText,
			subsections: { [subsectionKey]: subsectionValue },
		});
	}

	return categories;
}

function extractCoreStrategy(content, concern, isSimplified = false) {
	// Try to extract core strategy from content
	const strategyPatterns = isSimplified
		? [
				/æ ¸å¿ƒç­–ç•¥[ï¼š:]([^ã€‚\n]*)/,
				/æ ¸å¿ƒåŸåˆ™[ï¼š:]([^ã€‚\n]*)/,
				/ä¸»è¦æ–¹é’ˆ[ï¼š:]([^ã€‚\n]*)/,
			]
		: [
				/æ ¸å¿ƒç­–ç•¥[ï¼š:]([^ã€‚\n]*)/,
				/æ ¸å¿ƒåŸå‰‡[ï¼š:]([^ã€‚\n]*)/,
				/ä¸»è¦æ–¹é‡[ï¼š:]([^ã€‚\n]*)/,
			];

	for (let pattern of strategyPatterns) {
		const match = content.match(pattern);
		if (match && match[1]) {
			return match[1].trim();
		}
	}

	// Fallback strategies by concern
	const fallbackStrategies = isSimplified
		? {
				å¥åº·: "äº”è¡Œè°ƒå’Œï¼Œé˜´é˜³å¹³è¡¡",
				è²¡é‹: "åˆ¶ç«æŠ¤é‡‘ï¼Œè°ƒå€™è§£åˆ‘",
				å·¥ä½œ: "äº”è¡Œåˆ¶åŒ–ï¼Œç¨³æ­¥å‘å±•",
				äº‹æ¥­: "é¡ºåŠ¿è€Œä¸ºï¼Œåšå¾·è½½ç‰©",
				æ„Ÿæƒ…: "æ°´ç«æ—¢æµï¼Œæƒ…ç†å¹¶é‡",
			}
		: {
				å¥åº·: "äº”è¡Œèª¿å’Œï¼Œé™°é™½å¹³è¡¡",
				è²¡é‹: "è£½ç«è­·é‡‘ï¼Œèª¿å€™è§£åˆ‘",
				å·¥ä½œ: "äº”è¡Œåˆ¶åŒ–ï¼Œç©©æ­¥ç™¼å±•",
				äº‹æ¥­: "é †å‹¢è€Œç‚ºï¼Œåšå¾·è¼‰ç‰©",
				æ„Ÿæƒ…: "æ°´ç«æ—¢æ¿Ÿï¼Œæƒ…ç†ä¸¦é‡",
			};

	return (
		fallbackStrategies[concern] ||
		(isSimplified ? "äº”è¡Œè°ƒå’Œï¼Œå› æ—¶åˆ¶å®œ" : "äº”è¡Œèª¿å’Œï¼Œå› æ™‚åˆ¶å®œ")
	);
}

function generateFallbackContent(
	concern,
	birthday,
	gender,
	isSimplified = false
) {
	const genderText = isSimplified
		? gender === "male"
			? "ç”·æ€§"
			: "å¥³æ€§"
		: gender === "male"
			? "ç”·æ€§"
			: "å¥³æ€§";

	const fallbackTemplates = {
		è²¡é‹: `
ã€äº”è¡Œèª¿å’Œã€‘

æ ¹æ“šæ‚¨çš„å…«å­—å‘½ç›¤åˆ†æï¼Œè²¡é‹æå‡éœ€è¦é‡é»é—œæ³¨äº”è¡Œå¹³è¡¡èª¿ç†ï¼š

â‘  **é‡‘æ°´ç›¸ç”Ÿå‚¬è²¡æ³•**ï¼šæ‚¨çš„è²¡æ˜Ÿå±¬é‡‘ï¼Œéœ€è¦æ°´çš„æ»‹é¤Šæ‰èƒ½ç™¼æ®æœ€ä½³æ•ˆæœã€‚å»ºè­°åœ¨æ±åŒ—æ–¹ä½æ”¾ç½®æ°´æ™¶æ“ºä»¶æˆ–å°å‹æµæ°´è£ç½®ï¼Œæœ‰åŠ©æ–¼å‚¬å‹•è²¡æ°£ã€‚æ¯æ—¥å¯å¤šé£²æº«é–‹æ°´ï¼Œç©¿è‘—è—è‰²æˆ–é»‘è‰²æœé£¾å¢å¼·æ°´å…ƒç´ èƒ½é‡ã€‚

â‘¡ **åœŸé‡‘ç›¸ç”Ÿå›ºè²¡åŸº**ï¼šåœŸèƒ½ç”Ÿé‡‘ï¼Œåœ¨è¾¦å…¬æ¡Œæˆ–å®¶ä¸­è²¡ä½æ”¾ç½®é»ƒè‰²æ°´æ™¶æˆ–é™¶ç“·è£é£¾å“ï¼Œæœ‰åŠ©æ–¼ç©©å›ºè²¡é‹æ ¹åŸºã€‚å»ºè­°é¸æ“‡æ–¹å½¢æˆ–æ­£æ–¹å½¢çš„æ“ºä»¶ï¼Œè±¡å¾µç©©å®šå’Œç©ç´¯ã€‚

â‘¢ **é¿å…ç«å…‹é‡‘ç ´è²¡**ï¼šæ³¨æ„é¿å…ç´…è‰²éå¤šçš„ç’°å¢ƒï¼Œæ¸›å°‘ä½¿ç”¨å°–éŠ³ç‰©å“ï¼Œç«çš„èƒ½é‡æœƒå…‹åˆ¶æ‚¨çš„è²¡æ˜Ÿï¼Œå½±éŸ¿è²¡é‹ç™¼å±•ã€‚

ã€è¡Œç‚ºå¿ƒæ€§ã€‘

è²¡é‹å¿ƒæ€§èª¿é¤Šå°${genderText}å°¤å…¶é‡è¦ï¼Œéœ€è¦åŸ¹é¤Šæ­£ç¢ºçš„ç†è²¡è§€å¿µï¼š

â‘  **ç©©å¥ä¿å®ˆç­–ç•¥**ï¼šæ‚¨çš„å…«å­—åå‘ç©©å¥å‹è²¡é‹ï¼Œä¸å®œå†’éšªæŠ•æ©Ÿã€‚å»ºè­°åˆ¶å®šé•·æœŸç†è²¡è¨ˆåŠƒï¼Œé¸æ“‡é¢¨éšªè¼ƒä½çš„æŠ•è³‡æ–¹å¼ï¼Œå¦‚å®šæœŸå­˜æ¬¾ã€ç©©å¥å‹åŸºé‡‘ç­‰ã€‚

â‘¡ **äººéš›é—œä¿‚ç¶­è­·**ï¼šè²¡é‹å¾€å¾€èˆ‡äººéš›é—œä¿‚å¯†åˆ‡ç›¸é—œï¼Œå¤šèˆ‡å¿—åŒé“åˆçš„æœ‹å‹äº¤æµç†è²¡å¿ƒå¾—ï¼Œé¿å…ç¨æ–·å°ˆè¡Œã€‚åœ¨é‡‘èæ±ºç­–æ™‚å¯å¤šè½å–å°ˆæ¥­äººå£«å»ºè­°ã€‚

â‘¢ **ç¯€åˆ¶æ…¾æœ›ç®¡æ§**ï¼šé¿å…è¡å‹•æ¶ˆè²»å’Œéåº¦è¿½æ±‚ç‰©è³ªäº«å—ï¼ŒåŸ¹é¤Šç†æ€§æ¶ˆè²»ç¿’æ…£ã€‚å»ºè­°æ¯æœˆåˆ¶å®šé ç®—ï¼Œåš´æ ¼æ§åˆ¶éå¿…è¦æ”¯å‡ºã€‚

ã€é¢¨æ°´è¼”åŠ©ã€‘

é€šéé¢¨æ°´èª¿ç†å¼·åŒ–æ‚¨çš„è²¡é‹ç£å ´ï¼š

â‘  **è²¡ä½ä½ˆå±€å„ªåŒ–**ï¼šåœ¨å®¢å»³å°è§’ç·šä½ç½®ï¼ˆè²¡ä½ï¼‰ä¿æŒæ˜äº®æ•´æ½”ï¼Œå¯æ”¾ç½®æ‹›è²¡æ¤ç‰©å¦‚ç™¼è²¡æ¨¹ã€é‡‘éŒ¢æ¨¹ï¼Œæˆ–æ“ºæ”¾è²¡ç¥çˆºåƒã€‚é¿å…åœ¨æ­¤ä½ç½®æ”¾ç½®é›œç‰©æˆ–åƒåœ¾æ¡¶ã€‚

â‘¡ **è¾¦å…¬ç’°å¢ƒèª¿æ•´**ï¼šè¾¦å…¬æ¡Œé¢å‘é–€å£ä½†ä¸ç›´è¡ï¼ŒèƒŒå¾Œè¦æœ‰å¯¦ç‰†ä¾é ã€‚å·¦å´ï¼ˆé’é¾ä½ï¼‰å¯æ”¾ç½®ç¶ è‰²æ¤ç‰©æˆ–æ°´æ™¶ï¼Œå³å´ï¼ˆç™½è™ä½ï¼‰ä¿æŒç›¸å°æ•´æ½”ã€‚

â‘¢ **è‡¥å®¤è²¡é‹èª¿ç†**ï¼šåºŠé ­æœå‘æ±æˆ–æ±å—æ–¹ï¼Œæœ‰åˆ©æ–¼è²¡é‹æå‡ã€‚é¿å…åºŠé ­é çª—æˆ–å°é–€ï¼Œä¿æŒè‡¥å®¤ç©ºæ°£æµé€šä½†ä¸å¯æœ‰ç©¿å ‚é¢¨ã€‚

ã€æ“‡æ™‚è€Œå‹•ã€‘

æŒæ¡æ™‚æ©Ÿæ˜¯è²¡é‹æˆåŠŸçš„é—œéµï¼š

â‘  **æœˆä»½è²¡é‹æ—ºè¡°**ï¼šæ¯å¹´ç§‹å­£ï¼ˆè¾²æ›†ä¸ƒå…«ä¹æœˆï¼‰æ˜¯æ‚¨è²¡é‹æœ€æ—ºçš„æ™‚æœŸï¼Œé©åˆé€²è¡Œé‡è¦æŠ•è³‡æ±ºç­–æˆ–äº‹æ¥­æ‹“å±•ã€‚æ˜¥å­£éœ€è¬¹æ…ç†è²¡ï¼Œé¿å…å¤§é¡æ”¯å‡ºã€‚

â‘¡ **æ¯æ—¥æœ€ä½³æ™‚æ®µ**ï¼šç”³æ™‚ï¼ˆ15:00-17:00ï¼‰å’Œé…‰æ™‚ï¼ˆ17:00-19:00ï¼‰æ˜¯æ‚¨çš„è²¡é‹æ™‚è¾°ï¼Œé©åˆè™•ç†é‡‘èäº‹å‹™ã€å•†å‹™è«‡åˆ¤æˆ–æŠ•è³‡æ“ä½œã€‚

â‘¢ **å¹´åº¦è¦åŠƒå»ºè­°**ï¼š${new Date().getFullYear()}å¹´é‡é»åœ¨æ–¼ç©©å›ºè²¡å‹™åŸºç¤ï¼Œ2025å¹´å¯è€ƒæ…®é©åº¦æ“´å¼µã€‚é¿å…åœ¨å¤å­£åšé‡å¤§è²¡å‹™æ±ºç­–ï¼Œå†¬å­£é©åˆèª¿æ•´æŠ•è³‡çµ„åˆã€‚
`,
		äº‹æ¥­: `
ã€äº”è¡Œèª¿å’Œã€‘

äº‹æ¥­ç™¼å±•éœ€è¦äº”è¡Œèƒ½é‡çš„å‡è¡¡é…åˆï¼š

â‘  **æœ¨ç«é€šæ˜äº‹æ¥­æ—º**ï¼šæ‚¨çš„äº‹æ¥­æ˜Ÿéœ€è¦æœ¨ç«ç›¸åŠ©ï¼Œå»ºè­°è¾¦å…¬ç’°å¢ƒå¤šä½¿ç”¨ç¶ è‰²å’Œç´…è‰²å…ƒç´ ã€‚å¯åœ¨è¾¦å…¬æ¡Œæ”¾ç½®ç¶ è‰²æ¤ç‰©ï¼Œç©¿è‘—ç¶ è‰²æˆ–ç´…è‰²æœé£¾å¢å¼·äº‹æ¥­é‹å‹¢ã€‚

â‘¡ **é‡‘æ°´ç›¸ç”Ÿæ™ºæ…§å¢**ï¼šé…æˆ´é‡‘å±¬é£¾å“æˆ–ç™½è‰²æ°´æ™¶æœ‰åŠ©æ–¼æå‡å·¥ä½œæ•ˆç‡å’Œæ±ºç­–èƒ½åŠ›ã€‚æ¯æ—¥å¤šé£²æ°´ï¼Œä¿æŒé ­è…¦æ¸…æ™°ï¼Œæœ‰åˆ©æ–¼äº‹æ¥­ç™¼å±•ã€‚

â‘¢ **åœŸçš„æ”¯æ’è¦ç©©å›º**ï¼šåœ¨è¾¦å…¬ç’°å¢ƒä¸­åŠ å…¥é»ƒè‰²æˆ–åœŸè‰²å…ƒç´ ï¼Œå¦‚é»ƒè‰²æ–‡ä»¶å¤¾ã€åœŸè‰²åœ°æ¯¯ç­‰ï¼Œèƒ½å¤ ç‚ºäº‹æ¥­ç™¼å±•æä¾›ç©©å®šçš„åŸºç¤æ”¯æ’ã€‚

ã€è¡Œç‚ºå¿ƒæ€§ã€‘

äº‹æ¥­æˆåŠŸçš„å¿ƒæ€§ä¿®é¤Šè‡³é—œé‡è¦ï¼š

â‘  **ç©æ¥µä¸»å‹•ç²¾ç¥**ï¼š${genderText}åœ¨äº‹æ¥­ä¸Šè¦å±•ç¾æ›´å¤šä¸»å‹•æ€§ï¼Œä¸»å‹•æ‰¿æ“”è²¬ä»»ï¼Œç©æ¥µåƒèˆ‡é …ç›®ï¼Œä¸è¦ç­‰å¾…æ©Ÿæœƒè€Œè¦å‰µé€ æ©Ÿæœƒã€‚

â‘¡ **å­¸ç¿’æˆé•·å¿ƒæ…‹**ï¼šæŒçºŒå­¸ç¿’æ–°æŠ€èƒ½å’ŒçŸ¥è­˜ï¼Œé—œæ³¨è¡Œæ¥­ç™¼å±•è¶¨å‹¢ã€‚å»ºè­°å®šæœŸåƒåŠ å°ˆæ¥­åŸ¹è¨“æˆ–ç ”ç¿’èª²ç¨‹ï¼Œæå‡è‡ªèº«ç«¶çˆ­åŠ›ã€‚

â‘¢ **åœ˜éšŠå”ä½œèƒ½åŠ›**ï¼šæ³¨é‡èˆ‡åŒäº‹å’Œä¸Šå¸çš„é—œä¿‚ç¶­è­·ï¼Œå±•ç¾è‰¯å¥½çš„æºé€šèƒ½åŠ›å’Œåœ˜éšŠç²¾ç¥ã€‚é¿å…ç¨æ–·å°ˆè¡Œï¼Œå­¸æœƒå‚¾è½ä»–äººæ„è¦‹ã€‚

ã€é¢¨æ°´è¼”åŠ©ã€‘

è¾¦å…¬ç’°å¢ƒçš„é¢¨æ°´èª¿ç†èƒ½æœ‰æ•ˆæå‡äº‹æ¥­é‹ï¼š

â‘  **è¾¦å…¬æ¡Œæ“ºè¨­**ï¼šè¾¦å…¬æ¡Œä¿æŒæ•´æ½”æœ‰åºï¼Œæ–‡ä»¶åˆ†é¡æ¸…æ¥šã€‚å·¦å´æ”¾ç½®ç¶ è‰²æ¤ç‰©è±¡å¾µç”Ÿæ©Ÿï¼Œå³å´å¯æ”¾ç½®ç™½è‰²æˆ–é‡‘è‰²é£¾å“å¢å¼·è²´äººé‹ã€‚

â‘¡ **åº§ä½æ–¹å‘é¸æ“‡**ï¼šåº§ä½èƒŒå¾Œè¦æœ‰å¯¦ç‰†æˆ–é«˜æ«ƒä½œç‚ºé å±±ï¼Œé¢å‘é–‹é—Šç©ºé–“ã€‚é¿å…èƒŒå°é–€å£æˆ–ååœ¨æ¨‘ä¸‹ï¼Œé€™æœƒå½±éŸ¿äº‹æ¥­ç™¼å±•çš„ç©©å®šæ€§ã€‚

â‘¢ **è¾¦å…¬å®¤è‰²å½©æ­é…**ï¼šæ•´é«”è‰²èª¿ä»¥æ·ºè‰²ç‚ºä¸»ï¼Œé»ç¶´é©é‡çš„ç¶ è‰²å’Œè—è‰²ã€‚é¿å…ä½¿ç”¨éå¤šé»‘è‰²æˆ–æ·±è‰²ï¼Œæœƒå½±éŸ¿å·¥ä½œæƒ…ç·’å’Œæ•ˆç‡ã€‚

ã€æ“‡æ™‚è€Œå‹•ã€‘

æŠŠæ¡äº‹æ¥­ç™¼å±•çš„é—œéµæ™‚æ©Ÿï¼š

â‘  **å­£ç¯€æ€§æ©Ÿé‡**ï¼šæ˜¥å­£æ˜¯æ‚¨äº‹æ¥­ç™¼å±•çš„é»ƒé‡‘æœŸï¼Œé©åˆå•Ÿå‹•æ–°é …ç›®æˆ–å°‹æ±‚è·ä½æ™‰å‡ã€‚å¤å­£è¦è¬¹æ…è™•ç†è·å ´é—œä¿‚ï¼Œç§‹å­£é©åˆæ”¶ç©«æˆæœã€‚

â‘¡ **æ¯æ—¥å·¥ä½œæ™‚æ®µ**ï¼šå¯æ™‚ï¼ˆ5:00-7:00ï¼‰å’Œè¾°æ™‚ï¼ˆ7:00-9:00ï¼‰æ˜¯æ‚¨ç²¾åŠ›æœ€æ—ºç››çš„æ™‚æ®µï¼Œé©åˆè™•ç†é‡è¦å·¥ä½œæˆ–åšé—œéµæ±ºç­–ã€‚

â‘¢ **å¹´åº¦è·æ¶¯è¦åŠƒ**ï¼š${new Date().getFullYear()}å¹´é‡é»åœ¨æ–¼æŠ€èƒ½æå‡å’Œäººè„ˆç©ç´¯ï¼Œ2025å¹´å¯è€ƒæ…®æ›´å¤§çš„è·æ¥­ç™¼å±•ç›®æ¨™ã€‚
`,
		æ„Ÿæƒ…: `
ã€äº”è¡Œèª¿å’Œã€‘

æ„Ÿæƒ…å’Œè«§éœ€è¦äº”è¡Œèƒ½é‡çš„å¹³è¡¡ï¼š

â‘  **æ°´æœ¨ç›¸ç”Ÿæƒ…æ„é•·**ï¼šæ„Ÿæƒ…å±¬æ°´ï¼Œéœ€è¦æœ¨çš„æ»‹é¤Šã€‚å»ºè­°å¤šåˆ°å…¬åœ’æˆ–æ£®æ—ç­‰ç¶ è‰²ç’°å¢ƒç´„æœƒï¼Œæœ‰åŠ©æ–¼æ„Ÿæƒ…å‡æº«ã€‚å±…å®¶å¯æ”¾ç½®æ°´åŸ¹æ¤ç‰©ï¼Œè±¡å¾µæ„›æƒ…çš„æ»‹é¤Šæˆé•·ã€‚

â‘¡ **ç«åœŸç›¸åŠ©æƒ…ç·£ç©©**ï¼šé©é‡çš„ç«å…ƒç´ èƒ½å¢é€²æ„Ÿæƒ…ç†±åº¦ï¼Œå¯é¸æ“‡ç²‰è‰²æˆ–æ·¡ç´…è‰²çš„æœé£¾ã€‚åœŸå…ƒç´ å‰‡æä¾›ç©©å®šæ€§ï¼Œé»ƒè‰²é£¾å“æˆ–æ“ºä»¶æœ‰åŠ©æ–¼æ„Ÿæƒ…é—œä¿‚çš„ç©©å›ºã€‚

â‘¢ **é‡‘çš„èª¿ç¯€è¦é©åº¦**ï¼šé‡‘å…ƒç´ éæ—ºæœƒè®“æ„Ÿæƒ…è®Šå¾—ç†æ€§å†·æ·¡ï¼Œå»ºè­°æ¸›å°‘ç™½è‰²å’Œé‡‘è‰²åœ¨è‡¥å®¤çš„ä½¿ç”¨ï¼Œç‡Ÿé€ æº«é¦¨æµªæ¼«çš„æ°›å›´ã€‚

ã€è¡Œç‚ºå¿ƒæ€§ã€‘

${genderText}åœ¨æ„Ÿæƒ…ä¸­éœ€è¦æ³¨æ„çš„å¿ƒæ€§èª¿é¤Šï¼š

â‘  **åŒ…å®¹ç†è§£ç²¾ç¥**ï¼šå­¸æœƒåŒ…å®¹å°æ–¹çš„ä¸å®Œç¾ï¼Œç†è§£å°æ–¹çš„ç«‹å ´å’Œæƒ³æ³•ã€‚é¿å…éåˆ†æŒ‘å‰”æˆ–è¦æ±‚å°æ–¹æ”¹è®Šï¼Œçæƒœå½¼æ­¤çš„å·®ç•°æ€§ã€‚

â‘¡ **æºé€šè¡¨é”æŠ€å·§**ï¼šä¸»å‹•è¡¨é”è‡ªå·±çš„æ„Ÿå—å’Œéœ€æ±‚ï¼Œä¹Ÿè¦è€å¿ƒå‚¾è½å°æ–¹çš„å¿ƒè²ã€‚é¿å…å†·æˆ°æˆ–é€ƒé¿å•é¡Œï¼ŒåŠæ™‚åŒ–è§£èª¤æœƒå’ŒçŸ›ç›¾ã€‚

â‘¢ **å¹³è¡¡ç©ºé–“éœ€æ±‚**ï¼šçµ¦å½¼æ­¤é©ç•¶çš„å€‹äººç©ºé–“ï¼Œä¿æŒç¨ç«‹æ€§çš„åŒæ™‚ä¹Ÿè¦ç¶­æŒè¦ªå¯†æ„Ÿã€‚é¿å…éåº¦ä¾è³´æˆ–æ§åˆ¶å°æ–¹ã€‚

ã€é¢¨æ°´è¼”åŠ©ã€‘

é€šéé¢¨æ°´èª¿ç†å¢é€²æ„Ÿæƒ…é‹å‹¢ï¼š

â‘  **è‡¥å®¤ä½ˆç½®**ï¼šè‡¥å®¤è‰²èª¿ä»¥æº«é¦¨çš„ç²‰è‰²ã€æ·¡é»ƒè‰²ç‚ºä¸»ï¼Œé¿å…éæ–¼å¯’å†·çš„è‰²å½©ã€‚åºŠé ­å¯æ”¾ç½®æˆå°çš„æ“ºä»¶ï¼Œè±¡å¾µæ„Ÿæƒ…å’Œè«§ã€‚

â‘¡ **å®¢å»³æƒ…æ„Ÿå€**ï¼šåœ¨å®¢å»³è¥¿å—æ–¹ï¼ˆæ¡ƒèŠ±ä½ï¼‰æ”¾ç½®é®®èŠ±æˆ–ç²‰è‰²æ°´æ™¶ï¼Œæœ‰åŠ©æ–¼æ‹›æ”¬æ¡ƒèŠ±é‹æˆ–å¢é€²ç¾æœ‰æ„Ÿæƒ…ã€‚ä¿æŒæ­¤å€åŸŸæ•´æ½”æ˜äº®ã€‚

â‘¢ **ç´„æœƒç’°å¢ƒé¸æ“‡**ï¼šé¸æ“‡å…‰ç·šæŸ”å’Œã€ç’°å¢ƒå„ªé›…çš„å ´æ‰€ç´„æœƒï¼Œå¦‚å’–å•¡å»³ã€è—è¡“é¤¨ç­‰ã€‚é¿å…å˜ˆé›œæˆ–éæ–¼åˆºæ¿€çš„ç’°å¢ƒã€‚

ã€æ“‡æ™‚è€Œå‹•ã€‘

æ„Ÿæƒ…ç™¼å±•çš„æ™‚æ©ŸæŠŠæ¡ï¼š

â‘  **å­£ç¯€æ€§æƒ…æ„Ÿé€±æœŸ**ï¼šæ˜¥å­£æ˜¯æ„Ÿæƒ…èŒèŠ½æˆ–å¾©ç”¦çš„æœ€ä½³æ™‚æ©Ÿï¼Œå¤å­£æ„Ÿæƒ…ç†±çƒˆä½†è¦é¿å…è¡å‹•ã€‚ç§‹å­£é©åˆæ·±åŒ–é—œä¿‚ï¼Œå†¬å­£é‡åœ¨ç¶­è­·å’Œèª¿ç†ã€‚

â‘¡ **æ¯æ—¥æœ€ä½³æ™‚æ®µ**ï¼šå­æ™‚ï¼ˆ23:00-1:00ï¼‰å’Œå¯æ™‚ï¼ˆ5:00-7:00ï¼‰æ˜¯æ„Ÿæƒ…èƒ½é‡æœ€å¼·çš„æ™‚æ®µï¼Œé©åˆæ·±åº¦æºé€šæˆ–è¦ªå¯†äº’å‹•ã€‚

â‘¢ **é‡è¦ç¯€é»æŠŠæ¡**ï¼š${new Date().getFullYear()}å¹´é‡é»åœ¨æ–¼æ„Ÿæƒ…çš„ç©©å®šç™¼å±•ï¼Œ2025å¹´å¯è€ƒæ…®æ›´é€²ä¸€æ­¥çš„æ‰¿è«¾ã€‚é¿å…åœ¨å¤å­£åšé‡å¤§æ„Ÿæƒ…æ±ºå®šã€‚
`,
		å¥åº·: `
ã€äº”è¡Œèª¿å’Œã€‘

èº«é«”å¥åº·éœ€è¦äº”è¡Œçš„å”èª¿å¹³è¡¡ï¼š

â‘  **è‚æœ¨ç–æ³„èª¿ç†**ï¼šè‚å±¬æœ¨ï¼Œéœ€è¦ä¿æŒæƒ…ç·’èˆ’æš¢å’Œé©åº¦é‹å‹•ã€‚å»ºè­°å¤šåšæ‹‰ä¼¸é‹å‹•ï¼Œå¦‚ç‘œä¼½ã€å¤ªæ¥µç­‰ï¼Œæœ‰åŠ©æ–¼è‚æ°£ç–é€šã€‚æ˜¥å­£ç‰¹åˆ¥è¦æ³¨æ„è‚è‡Ÿé¤Šè­·ã€‚

â‘¡ **å¿ƒç«å¹³å’Œèª¿ç¯€**ï¼šå¿ƒå±¬ç«ï¼Œè¦é¿å…éåº¦æ¿€å‹•æˆ–ç„¦æ…®ã€‚å»ºè­°ä¿æŒè¦å¾‹ä½œæ¯ï¼Œé¿å…ç†¬å¤œï¼Œé©ç•¶é€²è¡Œæœ‰æ°§é‹å‹•å¦‚æ…¢è·‘ã€æ¸¸æ³³ç­‰ï¼Œç¶­æŒå¿ƒç«å¹³å’Œã€‚

â‘¢ **è„¾åœŸå¥é‹å¼·åŒ–**ï¼šè„¾èƒƒå±¬åœŸï¼Œæ˜¯å¾Œå¤©ä¹‹æœ¬ã€‚è¦æ³¨æ„é£²é£Ÿè¦å¾‹ï¼Œé¸æ“‡æº«å’Œæ˜“æ¶ˆåŒ–çš„é£Ÿç‰©ï¼Œé¿å…ç”Ÿå†·å’Œè¾›è¾£åˆºæ¿€æ€§é£Ÿå“ã€‚

ã€è¡Œç‚ºå¿ƒæ€§ã€‘

${genderText}çš„å¥åº·å¿ƒæ€§èª¿é¤Šè¦é»ï¼š

â‘  **æƒ…ç·’ç®¡ç†èª¿æ§**ï¼šå­¸æœƒæ§åˆ¶æƒ…ç·’æ³¢å‹•ï¼Œé¿å…é•·æœŸè™•æ–¼å£“åŠ›å’Œç„¦æ…®ç‹€æ…‹ã€‚å¯é€šéå†¥æƒ³ã€æ·±å‘¼å¸ç­‰æ–¹å¼æ”¾é¬†å¿ƒæƒ…ï¼Œç¶­æŒå…§å¿ƒå¹³éœã€‚

â‘¡ **ä½œæ¯è¦å¾‹é¤Šæˆ**ï¼šå»ºç«‹å›ºå®šçš„ä½œæ¯æ™‚é–“è¡¨ï¼Œä¿è­‰å……è¶³çš„ç¡çœ æ™‚é–“ã€‚æ—©ç¡æ—©èµ·ç¬¦åˆè‡ªç„¶è¦å¾‹ï¼Œæœ‰åŠ©æ–¼èº«é«”æ©Ÿèƒ½çš„æ¢å¾©å’Œèª¿ç¯€ã€‚

â‘¢ **é‹å‹•ç¿’æ…£åŸ¹é¤Š**ï¼šæ ¹æ“šå€‹äººé«”è³ªé¸æ“‡é©åˆçš„é‹å‹•æ–¹å¼ï¼Œå …æŒè¦å¾‹é‹å‹•ã€‚é¿å…éåº¦åŠ‡çƒˆé‹å‹•ï¼Œä»¥æº«å’Œçš„æœ‰æ°§é‹å‹•ç‚ºä¸»ã€‚

ã€é¢¨æ°´è¼”åŠ©ã€‘

å±…ä½ç’°å¢ƒå°å¥åº·çš„é¢¨æ°´å½±éŸ¿ï¼š

â‘  **è‡¥å®¤ç’°å¢ƒèª¿ç†**ï¼šè‡¥å®¤è¦ä¿æŒé©ç•¶çš„æº«åº¦å’Œæ¿•åº¦ï¼Œç©ºæ°£æµé€šä½†é¿å…ç›´é¢¨ã€‚åºŠé ­ä¸å®œæ­£å°çª—æˆ¶æˆ–é–€ï¼Œå½±éŸ¿ç¡çœ è³ªé‡ã€‚

â‘¡ **å»šæˆ¿é£²é£Ÿé¢¨æ°´**ï¼šå»šæˆ¿ä¿æŒæ•´æ½”è¡›ç”Ÿï¼Œç¶å°ä¸å®œæ­£å°å†°ç®±æˆ–æ°´æ§½ã€‚é¸ç”¨å¤©ç„¶é£Ÿæï¼Œå¤šåƒç•¶å­£è”¬æœï¼Œç¬¦åˆè‡ªç„¶è¦å¾‹ã€‚

â‘¢ **ç”Ÿæ´»ç©ºé–“è‰²å½©**ï¼šå±…ä½ç’°å¢ƒä»¥æ·¡é›…èˆ’é©çš„è‰²å½©ç‚ºä¸»ï¼Œé¿å…éæ–¼åˆºæ¿€çš„ç´…è‰²æˆ–éæ–¼é™°å†·çš„é»‘è‰²ã€‚ç¶ è‰²æ¤ç‰©æœ‰åŠ©æ–¼æ·¨åŒ–ç©ºæ°£å’Œèª¿ç¯€å¿ƒæƒ…ã€‚

ã€æ“‡æ™‚è€Œå‹•ã€‘

å¥åº·èª¿é¤Šçš„æ™‚æ©Ÿé¸æ“‡ï¼š

â‘  **å­£ç¯€æ€§é¤Šç”Ÿ**ï¼šæ˜¥å­£é¤Šè‚è­·è†½ï¼Œå¤å­£é¤Šå¿ƒèª¿ç¥ï¼Œç§‹å­£é¤Šè‚ºæ½¤ç‡¥ï¼Œå†¬å­£é¤Šè…å›ºç²¾ã€‚æ ¹æ“šå­£ç¯€ç‰¹é»èª¿æ•´é¤Šç”Ÿé‡é»ã€‚

â‘¡ **æ¯æ—¥é¤Šç”Ÿæ™‚æ®µ**ï¼šå¯æ™‚ï¼ˆ5:00-7:00ï¼‰é©åˆèµ·åºŠå’Œé‹å‹•ï¼Œåˆæ™‚ï¼ˆ11:00-13:00ï¼‰å¯é©ç•¶ä¼‘æ¯ï¼ŒæˆŒæ™‚ï¼ˆ19:00-21:00ï¼‰å¾Œé¿å…åŠ‡çƒˆé‹å‹•ã€‚

â‘¢ **å¹´åº¦å¥åº·è¦åŠƒ**ï¼š${new Date().getFullYear()}å¹´é‡é»åœ¨æ–¼å»ºç«‹å¥åº·çš„ç”Ÿæ´»ç¿’æ…£ï¼Œ2025å¹´å¯è€ƒæ…®æ›´æ·±å…¥çš„é«”è³ªèª¿ç†ã€‚å®šæœŸé«”æª¢ï¼Œé é˜²å‹æ–¼æ²»ç™‚ã€‚
`,
		å·¥ä½œ: `
ã€äº”è¡Œèª¿å’Œã€‘

å·¥ä½œæ•ˆç‡çš„äº”è¡Œèª¿å’Œä¹‹é“ï¼š

â‘  **é‡‘æ°´ç›¸ç”Ÿå¢æ™ºæ…§**ï¼šå·¥ä½œä¸­éœ€è¦é‡‘æ°´ç›¸ç”Ÿçš„èƒ½é‡æ”¯æŒã€‚è¾¦å…¬æ¡Œå¯æ”¾ç½®é‡‘å±¬æ–‡å…·å’Œé€æ˜æ°´æ¯ï¼Œæœ‰åŠ©æ–¼æå‡æ€ç¶­æ¸…æ™°åº¦å’Œå·¥ä½œæ•ˆç‡ã€‚

â‘¡ **æœ¨ç«é€šæ˜å‰µæ–°åŠ›**ï¼šå‰µæ–°æ€ç¶­éœ€è¦æœ¨ç«ç›¸åŠ©ã€‚è¾¦å…¬ç’°å¢ƒä¸­é©é‡ä½¿ç”¨ç¶ è‰²å’Œæš–è‰²èª¿ï¼Œèƒ½å¤ æ¿€ç™¼å‰µæ„å’Œå·¥ä½œç†±æƒ…ã€‚

â‘¢ **åœŸçš„ç©©å®šä½œæ”¯æ’**ï¼šå·¥ä½œçš„ç©©å®šæ€§éœ€è¦åœŸçš„èƒ½é‡ã€‚é¸æ“‡ç©©é‡çš„è¾¦å…¬å‚¢å…·ï¼Œä¿æŒå·¥ä½œç’°å¢ƒçš„æ•´æ½”æœ‰åºï¼Œæœ‰åŠ©æ–¼å·¥ä½œçš„æŒçºŒç™¼å±•ã€‚

ã€è¡Œç‚ºå¿ƒæ€§ã€‘

è·å ´æˆåŠŸçš„å¿ƒæ€§ä¿®é¤Šï¼š

â‘  **è²¬ä»»å¿ƒèˆ‡åŸ·è¡ŒåŠ›**ï¼š${genderText}åœ¨å·¥ä½œä¸­è¦å±•ç¾å¼·çƒˆçš„è²¬ä»»å¿ƒï¼Œå°åˆ†é…çš„ä»»å‹™èªçœŸè² è²¬ï¼Œæé«˜åŸ·è¡Œæ•ˆç‡ï¼Œæ¨¹ç«‹å¯é çš„è·æ¥­å½¢è±¡ã€‚

â‘¡ **å­¸ç¿’æˆé•·å¿ƒæ…‹**ï¼šä¿æŒé–‹æ”¾çš„å­¸ç¿’å¿ƒæ…‹ï¼Œä¸»å‹•å­¸ç¿’æ–°æŠ€èƒ½å’ŒçŸ¥è­˜ã€‚é—œæ³¨è¡Œæ¥­ç™¼å±•è¶¨å‹¢ï¼Œä¸æ–·æå‡è‡ªèº«çš„å°ˆæ¥­èƒ½åŠ›å’Œç«¶çˆ­åŠ›ã€‚

â‘¢ **åœ˜éšŠå”ä½œç²¾ç¥**ï¼šæ³¨é‡èˆ‡åŒäº‹çš„åˆä½œé—œä¿‚ï¼Œå±•ç¾è‰¯å¥½çš„åœ˜éšŠå”ä½œç²¾ç¥ã€‚é¿å…å€‹äººä¸»ç¾©ï¼Œå­¸æœƒåˆ†äº«ç¶“é©—å’Œè³‡æºã€‚

ã€é¢¨æ°´è¼”åŠ©ã€‘

å·¥ä½œç’°å¢ƒçš„é¢¨æ°´å„ªåŒ–ï¼š

â‘  **è¾¦å…¬æ¡Œä½èª¿æ•´**ï¼šè¾¦å…¬æ¡Œé¢å‘é–‹é—Šç©ºé–“ï¼ŒèƒŒå¾Œæœ‰å¯¦ç‰†æˆ–é«˜æ«ƒä½œç‚ºé å±±ã€‚æ¡Œé¢ä¿æŒæ•´æ½”ï¼Œé‡è¦æ–‡ä»¶åˆ†é¡å­˜æ”¾ï¼Œæå‡å·¥ä½œæ•ˆç‡ã€‚

â‘¡ **å…‰ç·šèˆ‡é€šé¢¨**ï¼šå·¥ä½œå€åŸŸè¦æœ‰å……è¶³çš„è‡ªç„¶å…‰ç·šï¼Œé©ç•¶çš„é€šé¢¨æ›æ°£ã€‚é¿å…èƒŒå…‰å·¥ä½œæˆ–åœ¨éæ–¼å°é–‰çš„ç©ºé–“å…§é•·æ™‚é–“å·¥ä½œã€‚

â‘¢ **æ¤ç‰©èˆ‡è‰²å½©**ï¼šè¾¦å…¬å€åŸŸå¯æ”¾ç½®ç¶ è‰²æ¤ç‰©ï¼Œå¦‚ç¶ è˜¿ã€ä»™äººæŒç­‰ï¼Œæœ‰åŠ©æ–¼èª¿ç¯€å·¥ä½œå£“åŠ›ã€‚è‰²å½©æ­é…ä»¥æ¸…æ·¡èˆ’é©ç‚ºä¸»ã€‚

ã€æ“‡æ™‚è€Œå‹•ã€‘

å·¥ä½œç™¼å±•çš„æ™‚æ©ŸæŠŠæ¡ï¼š

â‘  **å­£ç¯€æ€§å·¥ä½œé€±æœŸ**ï¼šæ˜¥å­£é©åˆå•Ÿå‹•æ–°é …ç›®æˆ–å­¸ç¿’æ–°æŠ€èƒ½ï¼Œå¤å­£å·¥ä½œå¼·åº¦è¼ƒå¤§éœ€è¦æ³¨æ„èª¿ç¯€ã€‚ç§‹å­£æ˜¯æ”¶ç©«æˆæœçš„å¥½æ™‚æ©Ÿï¼Œå†¬å­£é©åˆç¸½çµå’Œè¦åŠƒã€‚

â‘¡ **æ¯æ—¥æœ€ä½³å·¥ä½œæ™‚æ®µ**ï¼šè¾°æ™‚ï¼ˆ7:00-9:00ï¼‰å’Œç”³æ™‚ï¼ˆ15:00-17:00ï¼‰æ˜¯å·¥ä½œæ•ˆç‡æœ€é«˜çš„æ™‚æ®µï¼Œé©åˆè™•ç†é‡è¦ä»»å‹™æˆ–åšé—œéµæ±ºç­–ã€‚

â‘¢ **è·æ¥­ç™¼å±•è¦åŠƒ**ï¼š${new Date().getFullYear()}å¹´é‡é»åœ¨æ–¼æŠ€èƒ½æå‡å’Œç¶“é©—ç©ç´¯ï¼Œ2025å¹´å¯è€ƒæ…®æ›´å¤§çš„è·æ¥­çªç ´ã€‚æŠŠæ¡é—œéµæ™‚æ©Ÿï¼Œåšå¥½è·æ¥­è¦åŠƒã€‚
`,
	};

	return fallbackTemplates[concern] || fallbackTemplates.è²¡é‹;
}

function getFallbackCoreSuggestionData(concern, isSimplified = false) {
	const errorMsg = isSimplified
		? "AIåˆ†ææœåŠ¡æš‚æ—¶æ— æ³•ä½¿ç”¨ï¼Œè¯·ç¨åé‡è¯•ã€‚"
		: "AIåˆ†ææœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹ç¨å¾Œé‡è©¦ã€‚";
	const errorMsgDetail = isSimplified
		? "AIåˆ†ææœåŠ¡æš‚æ—¶æ— æ³•ä½¿ç”¨ï¼Œè¯·ç¨åé‡è¯•æˆ–è”ç³»å®¢æœã€‚"
		: "AIåˆ†ææœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹ç¨å¾Œé‡è©¦æˆ–è¯ç¹«å®¢æœã€‚";

	return {
		sections: isSimplified
			? {
					äº”è¡Œè°ƒå’Œ: errorMsg,
					è¡Œä¸ºå¿ƒæ€§: errorMsg,
					é£æ°´è¾…åŠ©: errorMsg,
					æ‹©æ—¶è°ƒå…»: errorMsg,
				}
			: {
					äº”è¡Œèª¿å’Œ: errorMsg,
					è¡Œç‚ºå¿ƒæ€§: errorMsg,
					é¢¨æ°´è¼”åŠ©: errorMsg,
					æ“‡æ™‚èª¿é¤Š: errorMsg,
				},
		categories: [
			{
				title: isSimplified ? "äº”è¡Œè°ƒå’Œ" : "äº”è¡Œèª¿å’Œ",
				icon: "â­",
				color: "bg-amber-500",
				content: errorMsgDetail,
			},
			{
				title: isSimplified ? "è¡Œä¸ºå¿ƒæ€§" : "è¡Œç‚ºå¿ƒæ€§",
				icon: "â¤ï¸",
				color: "bg-red-500",
				content: errorMsgDetail,
			},
			{
				title: isSimplified ? "é£æ°´è¾…åŠ©" : "é¢¨æ°´è¼”åŠ©",
				icon: "âš™ï¸",
				color: "bg-green-500",
				content: errorMsgDetail,
			},
			{
				title: isSimplified
					? concern === "å¥åº·"
						? "æ‹©æ—¶è°ƒå…»"
						: "æ‹©æ—¶è€ŒåŠ¨"
					: concern === "å¥åº·"
						? "æ“‡æ™‚èª¿é¤Š"
						: "æ“‡æ™‚è€Œå‹•",
				icon: "ğŸ•’",
				color: "bg-blue-500",
				content: errorMsgDetail,
			},
		],
		title: isSimplified
			? `å¼€è¿å»ºè®® (${concern}æŒ‡å—)`
			: `é–‹é‹å»ºè­° (${concern}æŒ‡å—)`,
		coreStrategy: isSimplified
			? "AIåˆ†ææœåŠ¡æš‚æ—¶ä¸å¯ç”¨"
			: "AIåˆ†ææœå‹™æš«æ™‚ä¸å¯ç”¨",
	};
}
