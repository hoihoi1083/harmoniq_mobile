# Mobile Payment Redirection Fix

## Issue

Users reported that after completing a payment in the mobile app (which opens a webview/browser for Stripe), they were not redirected back to the app but remained on the web success page.

## Root Cause

The `success_url` generated by the payment session APIs did not include the `mobile=true` parameter, even when the request originated from the mobile app. The `src/app/[locale]/success/page.jsx` component relies on this parameter to trigger the deep link redirection (`harmoniq://success...`).

## Fix Applied

Updated all payment session API routes to detect mobile requests (via `X-User-Email` or `X-User-ID` headers) and append `&mobile=true` to the `success_url`.

### Modified Files:

1.  `src/app/api/checkoutSessions/payment1/route.js` (Basic Subscription)
2.  `src/app/api/checkoutSessions/payment2/route.ts` (Premium Feng Shui)
3.  `src/app/api/checkoutSessions/payment3/route.js` (Expert188 - Testing?)
4.  `src/app/api/checkoutSessions/payment4/route.js` (Expert88)
5.  `src/app/api/checkoutSessions/payment1-sqm/route.js` (China Subscription)
6.  `src/app/api/checkoutSessions/payment2-sqm/route.js` (China Premium)

### Logic Added:

```javascript
// ðŸ“± MOBILE FIX: Detect if this is from mobile app and use appropriate success URL
const isMobileRequest = !!(mobileUserEmail || mobileUserId);
let successUrl = `${origin}/success?session_id={CHECKOUT_SESSION_ID}`;

if (isMobileRequest) {
	successUrl += "&mobile=true";
}
```

## Verification

- Ensure the mobile app sends `X-User-Email` or `X-User-ID` headers when calling these APIs.
- Verify that the `success_url` in the Stripe session includes `mobile=true`.
- Verify that `src/app/[locale]/success/page.jsx` correctly handles the redirection when `mobile=true` is present.
